<div class="patient-form {{if .ReadOnly}}readonly-mode{{end}}">
    <div class="patient-header">
        {{if .IsEditing}}
            <h2><i class="fas fa-user-edit"></i> Editar Paciente</h2>
        {{else if .ReadOnly}}
            <h2><i class="fas fa-user"></i> Información del Paciente</h2>
        {{else}}
            <h2><i class="fas fa-user-plus"></i> Nuevo Paciente</h2>
        {{end}}
    </div>

    {{if .Error}}
    <div class="error-message">
        <i class="fas fa-exclamation-circle"></i> {{.Error}}
    </div>
    {{end}}

    <div class="form-tabs">
        <div class="tab-header">
            <button type="button" class="tab-btn active" data-tab="personal">
                <i class="fas fa-address-card"></i> Información Personal
            </button>
            <button type="button" class="tab-btn" data-tab="contact">
                <i class="fas fa-phone"></i> Contacto
            </button>
            <button type="button" class="tab-btn" data-tab="medical">
                <i class="fas fa-notes-medical"></i> Información Médica
            </button>
            <button type="button" class="tab-btn" data-tab="anthropometric">
                <i class="fas fa-weight"></i> Datos Antropométricos
            </button>
            <button type="button" class="tab-btn" data-tab="lifestyle">
                <i class="fas fa-running"></i> Estilo de Vida
            </button>
            <button type="button" class="tab-btn" data-tab="specialist">
                <i class="fas fa-user-md"></i> Especialidades
            </button>
        </div>

        {{if .ReadOnly}}
        <div class="tab-content">
        {{else}}
        <form action="{{if .IsEditing}}/pacientes/{{.Paciente.ID}}/editar{{else}}/pacientes/crear{{end}}" method="post">
            <div class="tab-content">
        {{end}}
                <!-- Tab 1: Información Personal -->
                <div class="tab-pane active" id="tab-personal">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="nombre">Nombre*</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.Nombre}}</p>
                            {{else}}
                                <input type="text" id="nombre" name="nombre" value="{{.Paciente.Nombre}}" required {{if not .IsEditing}}autofocus{{end}}>
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="apellido">Apellido*</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.Apellido}}</p>
                            {{else}}
                                <input type="text" id="apellido" name="apellido" value="{{.Paciente.Apellido}}" required>
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="fechaNacimiento">Fecha de Nacimiento</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{if not .Paciente.FechaNacimiento.IsZero}}{{.Paciente.FechaNacimiento.Format "02/01/2006"}}{{else}}-{{end}}</p>
                            {{else}}
                                <input type="date" id="fechaNacimiento" name="fechaNacimiento" 
                                    {{if not .Paciente.FechaNacimiento.IsZero}}value="{{.Paciente.FechaNacimiento.Format "2006-01-02"}}"{{end}}>
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="genero">Género</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.Genero}}</p>
                            {{else}}
                                <select id="genero" name="genero">
                                    <option value="" {{if eq .Paciente.Genero ""}}selected{{end}}>Seleccionar</option>
                                    <option value="Masculino" {{if eq .Paciente.Genero "Masculino"}}selected{{end}}>Masculino</option>
                                    <option value="Femenino" {{if eq .Paciente.Genero "Femenino"}}selected{{end}}>Femenino</option>
                                    <option value="Otro" {{if eq .Paciente.Genero "Otro"}}selected{{end}}>Otro</option>
                                </select>
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="estadoCivil">Estado Civil</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.EstadoCivil}}</p>
                            {{else}}
                                <select id="estadoCivil" name="estadoCivil">
                                    <option value="" {{if eq .Paciente.EstadoCivil ""}}selected{{end}}>Seleccionar</option>
                                    <option value="Soltero/a" {{if eq .Paciente.EstadoCivil "Soltero/a"}}selected{{end}}>Soltero/a</option>
                                    <option value="Casado/a" {{if eq .Paciente.EstadoCivil "Casado/a"}}selected{{end}}>Casado/a</option>
                                    <option value="Divorciado/a" {{if eq .Paciente.EstadoCivil "Divorciado/a"}}selected{{end}}>Divorciado/a</option>
                                    <option value="Viudo/a" {{if eq .Paciente.EstadoCivil "Viudo/a"}}selected{{end}}>Viudo/a</option>
                                    <option value="Unión libre" {{if eq .Paciente.EstadoCivil "Unión libre"}}selected{{end}}>Unión libre</option>
                                </select>
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="nacionalidad">Nacionalidad</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.Nacionalidad}}</p>
                            {{else}}
                                <input type="text" id="nacionalidad" name="nacionalidad" placeholder="País de origen" value="{{.Paciente.Nacionalidad}}">
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="ocupacion">Ocupación</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.Ocupacion}}</p>
                            {{else}}
                                <input type="text" id="ocupacion" name="ocupacion" value="{{.Paciente.Ocupacion}}">
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="nivelEducativo">Nivel Educativo</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.NivelEducativo}}</p>
                            {{else}}
                                <select id="nivelEducativo" name="nivelEducativo">
                                    <option value="" {{if eq .Paciente.NivelEducativo ""}}selected{{end}}>Seleccionar</option>
                                    <option value="Primaria" {{if eq .Paciente.NivelEducativo "Primaria"}}selected{{end}}>Primaria</option>
                                    <option value="Secundaria" {{if eq .Paciente.NivelEducativo "Secundaria"}}selected{{end}}>Secundaria</option>
                                    <option value="Bachillerato" {{if eq .Paciente.NivelEducativo "Bachillerato"}}selected{{end}}>Bachillerato</option>
                                    <option value="Técnico" {{if eq .Paciente.NivelEducativo "Técnico"}}selected{{end}}>Técnico</option>
                                    <option value="Universidad" {{if eq .Paciente.NivelEducativo "Universidad"}}selected{{end}}>Universidad</option>
                                    <option value="Posgrado" {{if eq .Paciente.NivelEducativo "Posgrado"}}selected{{end}}>Posgrado</option>
                                </select>
                            {{end}}
                        </div>
                    </div>

                    <div class="tab-actions">
                        <button type="button" class="btn btn-primary next-tab" data-next="contact">
                            Siguiente <i class="fas fa-arrow-right"></i>
                        </button>
                        {{if .ReadOnly}}
                        <a href="/pacientes/{{.Paciente.ID}}/editar" class="btn btn-secondary">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                        {{end}}
                    </div>
                </div>

                <!-- Tab 2: Información de Contacto -->
                <div class="tab-pane" id="tab-contact">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="telefono">Teléfono</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.Telefono}}</p>
                            {{else}}
                                <input type="tel" id="telefono" name="telefono" value="{{.Paciente.Telefono}}">
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="telefonoAlternativo">Teléfono Alternativo</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.TelefonoAlternativo}}</p>
                            {{else}}
                                <input type="tel" id="telefonoAlternativo" name="telefonoAlternativo" value="{{.Paciente.TelefonoAlternativo}}">
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="email">Email</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.Email}}</p>
                            {{else}}
                                <input type="email" id="email" name="email" value="{{.Paciente.Email}}">
                            {{end}}
                        </div>

                        <div class="form-group full-width">
                            <label for="direccion">Dirección</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.Direccion}}</p>
                            {{else}}
                                <textarea id="direccion" name="direccion" rows="3">{{.Paciente.Direccion}}</textarea>
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="numeroSeguro">Número de Seguro</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.NumeroSeguro}}</p>
                            {{else}}
                                <input type="text" id="numeroSeguro" name="numeroSeguro" value="{{.Paciente.NumeroSeguro}}">
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="tipoSeguro">Tipo de Seguro</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.TipoSeguro}}</p>
                            {{else}}
                                <select id="tipoSeguro" name="tipoSeguro">
                                    <option value="" {{if eq .Paciente.TipoSeguro ""}}selected{{end}}>Seleccionar</option>
                                    <option value="Público" {{if eq .Paciente.TipoSeguro "Público"}}selected{{end}}>Público</option>
                                    <option value="Privado" {{if eq .Paciente.TipoSeguro "Privado"}}selected{{end}}>Privado</option>
                                    <option value="Social" {{if eq .Paciente.TipoSeguro "Social"}}selected{{end}}>Social</option>
                                    <option value="Internacional" {{if eq .Paciente.TipoSeguro "Internacional"}}selected{{end}}>Internacional</option>
                                </select>
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="numeroPoliza">Número de Póliza</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.NumeroPoliza}}</p>
                            {{else}}
                                <input type="text" id="numeroPoliza" name="numeroPoliza" value="{{.Paciente.NumeroPoliza}}">
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="fechaVencimientoPoliza">Fecha Vencimiento Póliza</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{if not .Paciente.FechaVencimientoPoliza.IsZero}}{{.Paciente.FechaVencimientoPoliza.Format "02/01/2006"}}{{else}}-{{end}}</p>
                            {{else}}
                                <input type="date" id="fechaVencimientoPoliza" name="fechaVencimientoPoliza" 
                                    {{if not .Paciente.FechaVencimientoPoliza.IsZero}}value="{{.Paciente.FechaVencimientoPoliza.Format "2006-01-02"}}"{{end}}>
                            {{end}}
                        </div>
                    </div>

                    <div class="section-title mt-4">
                        <h4><i class="fas fa-phone-alt"></i> Contacto de Emergencia</h4>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="contactoEmergenciaNombre">Nombre</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.ContactoEmergenciaNombre}}</p>
                            {{else}}
                                <input type="text" id="contactoEmergenciaNombre" name="contactoEmergenciaNombre" value="{{.Paciente.ContactoEmergenciaNombre}}">
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="contactoEmergenciaTel">Teléfono</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.ContactoEmergenciaTel}}</p>
                            {{else}}
                                <input type="tel" id="contactoEmergenciaTel" name="contactoEmergenciaTel" value="{{.Paciente.ContactoEmergenciaTel}}">
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="contactoEmergenciaRelacion">Relación</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.ContactoEmergenciaRelacion}}</p>
                            {{else}}
                                <input type="text" id="contactoEmergenciaRelacion" name="contactoEmergenciaRelacion" value="{{.Paciente.ContactoEmergenciaRelacion}}">
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="medicoAsignado">Médico Asignado</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.MedicoAsignado}}</p>
                            {{else}}
                                <input type="text" id="medicoAsignado" name="medicoAsignado" value="{{.Paciente.MedicoAsignado}}">
                            {{end}}
                        </div>
                    </div>

                    <div class="tab-actions">
                        <button type="button" class="btn btn-secondary prev-tab" data-prev="personal">
                            <i class="fas fa-arrow-left"></i> Anterior
                        </button>
                        <button type="button" class="btn btn-primary next-tab" data-next="medical">
                            Siguiente <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Tab 3: Información Médica -->
                <div class="tab-pane" id="tab-medical">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="grupoSanguineo">Grupo Sanguíneo</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.GrupoSanguineo}}</p>
                            {{else}}
                                <select id="grupoSanguineo" name="grupoSanguineo">
                                    <option value="" {{if eq .Paciente.GrupoSanguineo ""}}selected{{end}}>Seleccionar</option>
                                    <option value="A+" {{if eq .Paciente.GrupoSanguineo "A+"}}selected{{end}}>A+</option>
                                    <option value="A-" {{if eq .Paciente.GrupoSanguineo "A-"}}selected{{end}}>A-</option>
                                    <option value="B+" {{if eq .Paciente.GrupoSanguineo "B+"}}selected{{end}}>B+</option>
                                    <option value="B-" {{if eq .Paciente.GrupoSanguineo "B-"}}selected{{end}}>B-</option>
                                    <option value="AB+" {{if eq .Paciente.GrupoSanguineo "AB+"}}selected{{end}}>AB+</option>
                                    <option value="AB-" {{if eq .Paciente.GrupoSanguineo "AB-"}}selected{{end}}>AB-</option>
                                    <option value="O+" {{if eq .Paciente.GrupoSanguineo "O+"}}selected{{end}}>O+</option>
                                    <option value="O-" {{if eq .Paciente.GrupoSanguineo "O-"}}selected{{end}}>O-</option>
                                </select>
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="medicamentosActuales">Medicación Actual</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.MedicamentosActuales}}</p>
                            {{else}}
                                <input type="text" id="medicamentosActuales" name="medicamentosActuales" 
                                    placeholder="Medicamentos que toma regularmente" value="{{.Paciente.MedicamentosActuales}}">
                            {{end}}
                        </div>

                        <div class="form-group full-width">
                            <label for="alergias">Alergias</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.Alergias}}</p>
                            {{else}}
                                <textarea id="alergias" name="alergias" rows="2"
                                    placeholder="Medicamentos, alimentos, sustancias, etc.">{{.Paciente.Alergias}}</textarea>
                            {{end}}
                        </div>

                        <div class="form-group full-width">
                            <label for="enfermedadesCronicas">Enfermedades Crónicas</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.EnfermedadesCronicas}}</p>
                            {{else}}
                                <textarea id="enfermedadesCronicas" name="enfermedadesCronicas" rows="2"
                                    placeholder="Diabetes, hipertensión, etc.">{{.Paciente.EnfermedadesCronicas}}</textarea>
                            {{end}}
                        </div>

                        <div class="form-group full-width">
                            <label for="antecedentesQuirurgicos">Antecedentes Quirúrgicos</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.AntecedentesQuirurgicos}}</p>
                            {{else}}
                                <textarea id="antecedentesQuirurgicos" name="antecedentesQuirurgicos" rows="2"
                                    placeholder="Cirugías previas, fechas aproximadas">{{.Paciente.AntecedentesQuirurgicos}}</textarea>
                            {{end}}
                        </div>

                        <div class="form-group full-width">
                            <label for="antecedentesFamiliares">Antecedentes Familiares</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.AntecedentesFamiliares}}</p>
                            {{else}}
                                <textarea id="antecedentesFamiliares" name="antecedentesFamiliares" rows="2"
                                    placeholder="Enfermedades hereditarias o condiciones en la familia">{{.Paciente.AntecedentesFamiliares}}</textarea>
                            {{end}}
                        </div>

                        <div class="form-group full-width">
                            <label for="hospitalizaciones">Hospitalizaciones Previas</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.Hospitalizaciones}}</p>
                            {{else}}
                                <textarea id="hospitalizaciones" name="hospitalizaciones" rows="2"
                                    placeholder="Motivo, lugar y fecha aproximada">{{.Paciente.Hospitalizaciones}}</textarea>
                            {{end}}
                        </div>

                        <div class="form-group full-width">
                            <label for="discapacidadesCondicionesEspeciales">Discapacidades o Condiciones Especiales</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.DiscapacidadesCondicionesEspeciales}}</p>
                            {{else}}
                                <textarea id="discapacidadesCondicionesEspeciales" name="discapacidadesCondicionesEspeciales" rows="2">{{.Paciente.DiscapacidadesCondicionesEspeciales}}</textarea>
                            {{end}}
                        </div>

                        <div class="form-group full-width">
                            <label for="reaccionesMedicamentos">Reacciones Adversas a Medicamentos</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.ReaccionesMedicamentos}}</p>
                            {{else}}
                                <textarea id="reaccionesMedicamentos" name="reaccionesMedicamentos" rows="2"
                                    placeholder="Medicamentos y tipos de reacciones">{{.Paciente.ReaccionesMedicamentos}}</textarea>
                            {{end}}
                        </div>
                    </div>

                    <div class="section-title mt-4">
                        <h4><i class="fas fa-syringe"></i> Vacunación</h4>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="vacunasAplicadas">Vacunas Aplicadas</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.VacunasAplicadas}}</p>
                            {{else}}
                                <textarea id="vacunasAplicadas" name="vacunasAplicadas" rows="2"
                                    placeholder="Vacunas y fechas de aplicación">{{.Paciente.VacunasAplicadas}}</textarea>
                            {{end}}
                        </div>

                        <div class="form-group">
                            <label for="vacunasPendientes">Vacunas Pendientes</label>
                            {{if .ReadOnly}}
                                <p class="readonly-value">{{.Paciente.VacunasPendientes}}</p>
                            {{else}}
                            <textarea id="vacunasPendientes" name="vacunasPendientes" rows="2"
                            placeholder="Vacunas programadas o pendientes">{{.Paciente.VacunasPendientes}}</textarea>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="reaccionesVacunas">Reacciones a Vacunas</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.ReaccionesVacunas}}</p>
                    {{else}}
                        <textarea id="reaccionesVacunas" name="reaccionesVacunas" rows="2"
                            placeholder="Reacciones adversas a vacunas">{{.Paciente.ReaccionesVacunas}}</textarea>
                    {{end}}
                </div>
            </div>

            <div class="tab-actions">
                <button type="button" class="btn btn-secondary prev-tab" data-prev="contact">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button type="button" class="btn btn-primary next-tab" data-next="anthropometric">
                    Siguiente <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Tab 4: Datos Antropométricos -->
        <div class="tab-pane" id="tab-anthropometric">
            <div class="form-grid">
                <div class="form-group">
                    <label for="estatura">Estatura (cm)</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.Estatura}}</p>
                    {{else}}
                        <input type="number" step="0.1" id="estatura" name="estatura" value="{{.Paciente.Estatura}}">
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="peso">Peso (kg)</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.Peso}}</p>
                    {{else}}
                        <input type="number" step="0.1" id="peso" name="peso" value="{{.Paciente.Peso}}">
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="imc">IMC</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.IMC}}</p>
                    {{else}}
                        <input type="number" step="0.01" id="imc" name="imc" value="{{.Paciente.IMC}}" readonly>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="circunferenciaCintura">Circunferencia Cintura (cm)</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.CircunferenciaCintura}}</p>
                    {{else}}
                        <input type="number" step="0.1" id="circunferenciaCintura" name="circunferenciaCintura" value="{{.Paciente.CircunferenciaCintura}}">
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="circunferenciaCadera">Circunferencia Cadera (cm)</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.CircunferenciaCadera}}</p>
                    {{else}}
                        <input type="number" step="0.1" id="circunferenciaCadera" name="circunferenciaCadera" value="{{.Paciente.CircunferenciaCadera}}">
                    {{end}}
                </div>
            </div>

            <div class="tab-actions">
                <button type="button" class="btn btn-secondary prev-tab" data-prev="medical">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button type="button" class="btn btn-primary next-tab" data-next="lifestyle">
                    Siguiente <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Tab 5: Estilo de Vida -->
        <div class="tab-pane" id="tab-lifestyle">
            <div class="form-grid">
                <div class="form-group">
                    <label for="tabaquismo">Tabaquismo</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.Tabaquismo}}</p>
                    {{else}}
                        <select id="tabaquismo" name="tabaquismo">
                            <option value="" {{if eq .Paciente.Tabaquismo ""}}selected{{end}}>Seleccionar</option>
                            <option value="No fumador" {{if eq .Paciente.Tabaquismo "No fumador"}}selected{{end}}>No fumador</option>
                            <option value="Ex-fumador" {{if eq .Paciente.Tabaquismo "Ex-fumador"}}selected{{end}}>Ex-fumador</option>
                            <option value="Fumador ocasional" {{if eq .Paciente.Tabaquismo "Fumador ocasional"}}selected{{end}}>Fumador ocasional</option>
                            <option value="Fumador habitual" {{if eq .Paciente.Tabaquismo "Fumador habitual"}}selected{{end}}>Fumador habitual</option>
                        </select>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="consumoAlcohol">Consumo de Alcohol</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.ConsumoAlcohol}}</p>
                    {{else}}
                        <select id="consumoAlcohol" name="consumoAlcohol">
                            <option value="" {{if eq .Paciente.ConsumoAlcohol ""}}selected{{end}}>Seleccionar</option>
                            <option value="No consume" {{if eq .Paciente.ConsumoAlcohol "No consume"}}selected{{end}}>No consume</option>
                            <option value="Ocasional" {{if eq .Paciente.ConsumoAlcohol "Ocasional"}}selected{{end}}>Ocasional</option>
                            <option value="Frecuente" {{if eq .Paciente.ConsumoAlcohol "Frecuente"}}selected{{end}}>Frecuente</option>
                            <option value="Diario" {{if eq .Paciente.ConsumoAlcohol "Diario"}}selected{{end}}>Diario</option>
                        </select>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="actividadFisica">Actividad Física</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.ActividadFisica}}</p>
                    {{else}}
                        <select id="actividadFisica" name="actividadFisica">
                            <option value="" {{if eq .Paciente.ActividadFisica ""}}selected{{end}}>Seleccionar</option>
                            <option value="Sedentario" {{if eq .Paciente.ActividadFisica "Sedentario"}}selected{{end}}>Sedentario</option>
                            <option value="Ligera" {{if eq .Paciente.ActividadFisica "Ligera"}}selected{{end}}>Ligera</option>
                            <option value="Moderada" {{if eq .Paciente.ActividadFisica "Moderada"}}selected{{end}}>Moderada</option>
                            <option value="Intensa" {{if eq .Paciente.ActividadFisica "Intensa"}}selected{{end}}>Intensa</option>
                        </select>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="horasSueño">Horas de Sueño</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.HorasSueño}}</p>
                    {{else}}
                        <input type="text" id="horasSueño" name="horasSueño" value="{{.Paciente.HorasSueño}}">
                    {{end}}
                </div>

                <div class="form-group full-width">
                    <label for="habitosAlimenticios">Hábitos Alimenticios</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.HabitosAlimenticios}}</p>
                    {{else}}
                        <textarea id="habitosAlimenticios" name="habitosAlimenticios" rows="2"
                            placeholder="Describa la dieta habitual del paciente">{{.Paciente.HabitosAlimenticios}}</textarea>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="consumoDrogas">Consumo de Drogas</label>
                    {{if .ReadOnly}}
                        <p class="readonly-value">{{.Paciente.ConsumoDrogas}}</p>
                    {{else}}
                        <select id="consumoDrogas" name="consumoDrogas">
                            <option value="" {{if eq .Paciente.ConsumoDrogas ""}}selected{{end}}>Seleccionar</option>
                            <option value="No consume" {{if eq .Paciente.ConsumoDrogas "No consume"}}selected{{end}}>No consume</option>
                            <option value="Ocasional" {{if eq .Paciente.ConsumoDrogas "Ocasional"}}selected{{end}}>Ocasional</option>
                            <option value="Frecuente" {{if eq .Paciente.ConsumoDrogas "Frecuente"}}selected{{end}}>Frecuente</option>
                            <option value="Dependencia" {{if eq .Paciente.ConsumoDrogas "Dependencia"}}selected{{end}}>Dependencia</option>
                        </select>
                    {{end}}
                </div>
            </div>

            <div class="tab-actions">
                <button type="button" class="btn btn-secondary prev-tab" data-prev="anthropometric">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button type="button" class="btn btn-primary next-tab" data-next="specialist">
                    Siguiente <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Tab 6: Especialidades -->
        <div class="tab-pane" id="tab-specialist">
            <div class="form-sections">
                <div class="section-title">
                    <h4><i class="fas fa-heartbeat"></i> Cardiología</h4>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="presionArterialHabitual">Presión Arterial Habitual</label>
                        {{if .ReadOnly}}
                            <p class="readonly-value">{{.Paciente.PresionArterialHabitual}}</p>
                        {{else}}
                            <input type="text" id="presionArterialHabitual" name="presionArterialHabitual" placeholder="Ej: 120/80" value="{{.Paciente.PresionArterialHabitual}}">
                        {{end}}
                    </div>
                    <div class="form-group">
                        <label for="frecuenciaCardiacaReposo">Frecuencia Cardíaca en Reposo</label>
                        {{if .ReadOnly}}
                            <p class="readonly-value">{{.Paciente.FrecuenciaCardiacaReposo}}</p>
                        {{else}}
                            <input type="number" id="frecuenciaCardiacaReposo" name="frecuenciaCardiacaReposo" value="{{.Paciente.FrecuenciaCardiacaReposo}}">
                        {{end}}
                    </div>
                    <div class="form-group full-width">
                        <label for="problemasCardiacos">Problemas Cardíacos</label>
                        {{if .ReadOnly}}
                            <p class="readonly-value">{{.Paciente.ProblemasCardiacos}}</p>
                        {{else}}
                            <textarea id="problemasCardiacos" name="problemasCardiacos" rows="2">{{.Paciente.ProblemasCardiacos}}</textarea>
                        {{end}}
                    </div>
                </div>

                <div class="section-title">
                    <h4><i class="fas fa-eye"></i> Oftalmología</h4>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="problemasVision">Problemas de Visión</label>
                        {{if .ReadOnly}}
                            <p class="readonly-value">{{.Paciente.ProblemasVision}}</p>
                        {{else}}
                            <input type="text" id="problemasVision" name="problemasVision" value="{{.Paciente.ProblemasVision}}">
                        {{end}}
                    </div>
                    <div class="form-group">
                        <label for="graduacionLentes">Graduación de Lentes</label>
                        {{if .ReadOnly}}
                            <p class="readonly-value">{{.Paciente.GraduacionLentes}}</p>
                        {{else}}
                            <input type="text" id="graduacionLentes" name="graduacionLentes" value="{{.Paciente.GraduacionLentes}}">
                        {{end}}
                    </div>
                </div>

                <div class="section-title">
                    <h4><i class="fas fa-notes-medical"></i> Notas Adicionales</h4>
                </div>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="notasMedicas">Notas Médicas Generales</label>
                        {{if .ReadOnly}}
                            <p class="readonly-value">{{.Paciente.NotasMedicas}}</p>
                        {{else}}
                            <textarea id="notasMedicas" name="notasMedicas" rows="3">{{.Paciente.NotasMedicas}}</textarea>
                        {{end}}
                    </div>
                    <div class="form-group full-width">
                        <label for="informacionAdicional">Información Adicional</label>
                        {{if .ReadOnly}}
                            <p class="readonly-value">{{.Paciente.InformacionAdicional}}</p>
                        {{else}}
                            <textarea id="informacionAdicional" name="informacionAdicional" rows="3">{{.Paciente.InformacionAdicional}}</textarea>
                        {{end}}
                    </div>
                </div>
            </div>

            <div class="tab-actions">
                <button type="button" class="btn btn-secondary prev-tab" data-prev="lifestyle">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                
                {{if not .ReadOnly}}
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> {{if .IsEditing}}Actualizar{{else}}Guardar{{end}} Paciente
                    </button>
                {{else}}
                    <a href="/pacientes/{{.Paciente.ID}}/editar" class="btn btn-secondary">
                        <i class="fas fa-edit"></i> Editar
                    </a>
                    <a href="/pacientes/{{.Paciente.ID}}/eliminar" class="btn btn-danger">
                        <i class="fas fa-trash-alt"></i> Eliminar
                    </a>
                {{end}}
            </div>
        </div>
    </div>
{{if not .ReadOnly}}</form>{{end}}
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
// Navegación entre tabs
const tabBtns = document.querySelectorAll('.tab-btn');
const tabPanes = document.querySelectorAll('.tab-pane');
const nextBtns = document.querySelectorAll('.next-tab');
const prevBtns = document.querySelectorAll('.prev-tab');

tabBtns.forEach(btn => {
    btn.addEventListener('click', function () {
        const tabId = this.getAttribute('data-tab');

        // Desactivar todos los tabs y contenidos
        tabBtns.forEach(b => b.classList.remove('active'));
        tabPanes.forEach(p => p.classList.remove('active'));

        // Activar el tab seleccionado
        this.classList.add('active');
        document.getElementById('tab-' + tabId).classList.add('active');
    });
});

// Botones de navegación siguiente
nextBtns.forEach(btn => {
    btn.addEventListener('click', function () {
        const nextTabId = this.getAttribute('data-next');
        
        // Desactivar todos los tabs y contenidos
        tabBtns.forEach(b => b.classList.remove('active'));
        tabPanes.forEach(p => p.classList.remove('active'));

        // Activar el siguiente tab
        document.querySelector(`.tab-btn[data-tab="${nextTabId}"]`).classList.add('active');
        document.getElementById('tab-' + nextTabId).classList.add('active');
    });
});

// Botones de navegación anterior
prevBtns.forEach(btn => {
    btn.addEventListener('click', function () {
        const prevTabId = this.getAttribute('data-prev');
        
        // Desactivar todos los tabs y contenidos
        tabBtns.forEach(b => b.classList.remove('active'));
        tabPanes.forEach(p => p.classList.remove('active'));

        // Activar el tab anterior
        document.querySelector(`.tab-btn[data-tab="${prevTabId}"]`).classList.add('active');
        document.getElementById('tab-' + prevTabId).classList.add('active');
    });
});

{{if not .ReadOnly}}
// Cálculo automático del IMC
const pesoInput = document.getElementById('peso');
const estaturaInput = document.getElementById('estatura');
const imcInput = document.getElementById('imc');

function calcularIMC() {
    if (pesoInput.value && estaturaInput.value) {
        const peso = parseFloat(pesoInput.value);
        const estatura = parseFloat(estaturaInput.value) / 100; // convertir cm a metros
        if (peso > 0 && estatura > 0) {
            const imc = peso / (estatura * estatura);
            imcInput.value = imc.toFixed(2);
        }
    }
}

if (pesoInput && estaturaInput && imcInput) {
    pesoInput.addEventListener('input', calcularIMC);
    estaturaInput.addEventListener('input', calcularIMC);
    // Calcular IMC inicial si hay datos
    calcularIMC();
}
{{end}}
});
</script>